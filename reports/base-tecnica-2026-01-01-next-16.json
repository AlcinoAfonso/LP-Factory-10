{
"meta": {
"datetime": "01/01/2026 16:15",
"origin": "migracao",
"scope": "documentacao",
"execution_mode": "github_actions",
"target_doc": "docs/base-tecnica.md",
"warnings": []
},
"ops": [
{
"id": "A1",
"doc_path": "docs/base-tecnica.md",
"op": "replace_section",
"target": "2.1",
"content": "2.1 Framework (Frontend)\n\n• Next.js 16.1.1 (App Router)\n• React 19.2.x\n• TypeScript 5.5.4\n• Node 22 (Vercel + GitHub Actions)\n• Package manager: npm\n• Arquivo canônico (lockfile): package-lock.json (deve ficar commitado e alinhado ao package.json)\n• Build: Next 16.x usa Turbopack por padrão no build; evitar customizações via webpack() no next.config (preferir alias via tsconfig.json > paths)\n• Observação: pode aparecer warning “middleware file convention is deprecated”; migrar para proxy.* apenas quando necessário (ex.: exigência do build/codemod)\n"
},
{
"id": "A2",
"doc_path": "docs/base-tecnica.md",
"op": "replace_section",
"target": "3.4",
"content": "3.4 CI / Lint (bloqueios)\n\n• CI principal é via GitHub Actions + Vercel Preview (validação por PR)\n• Security (bloqueante em PR):\n• PATH: .github/workflows/security.yml (job: no-implicit-flow)\n• Regra: bloquear padrões de implicit flow (access_token/refresh_token/setSession/getSessionFromUrl) em client/UI\n• Regra: verifyOtp() só pode existir em app/auth/confirm/**\n• Workflow de upgrade (manutenção): ver seção 3.4.1\n• Lint:\n• No workflow de upgrade, lint é non-blocking (não deve impedir o bump/lockfile)\n• Regra de merge (mínimo): checks verdes + Vercel Preview ok + smoke tests de acesso (login/logout/reset de senha/navegação pós-login)\n"
},
{
"id": "A3",
"doc_path": "docs/base-tecnica.md",
"op": "replace_section",
"target": "3.13",
"content": "3.13 Versionamento Next.js (MVP)\n\n• Base atual: Next.js 16.1.1 + eslint-config-next 16.1.1\n• Node padrão (CI/Vercel): 22\n• Arquivo canônico (lockfile): package-lock.json (npm)\n• Upgrades:\n• Devem ser feitos preferencialmente via workflow manual\n• PATH: .github/workflows/upgrade-next-16-1-1.yml\n• Preferir minor/patch; saltos maiores só por CVE/breaking inevitável\n• Breaking changes práticas a considerar na geração de código (App Router):\n• APIs de request podem exigir await: cookies(), headers(), draftMode() (usar async quando necessário)\n• params/searchParams podem exigir await em algumas rotas/pages (usar async quando necessário)\n• Performance/build:\n• Next 16.x usa Turbopack por padrão no build; evitar webpack() custom no next.config quando possível\n• Smoke mínimo antes de merge:\n• Login (sucesso + erro credencial)\n• Logout + re-login (cookies/sessão ok)\n• Password reset (MVP)\n• Navegação básica pós-login (carrega dashboard/página principal)\n"
},
{
"id": "B1",
"doc_path": "docs/base-tecnica.md",
"op": "insert_after_section",
"anchor": "3.4",
"content": "3.4.1 Workflows de manutenção (Upgrade Next.js + lockfile)\n\n• PATH: .github/workflows/upgrade-next-16-1-1.yml\n• Disparo: workflow_dispatch (inputs: target_branch, next_version)\n• Objetivo: atualizar next + eslint-config-next para a versão informada e garantir package-lock.json versionado (npm)\n• Setup: Node 22 (npm)\n• Regras:\n• Se existir package-lock.json: usar npm ci; senão: npm install (gera lockfile)\n• Lint: npm run lint --if-present (non-blocking)\n• Build: npm run build --if-present (blocking)\n• Commit/push automático para a branch alvo quando houver mudanças\n"
},
{
"id": "C1",
"doc_path": "docs/base-tecnica.md",
"op": "insert_after_heading",
"heading": "8. Changelog",
"content": "• v1.9.5 | 30/12/2025 — Upgrade para Next.js 16.1.1 (App Router) + eslint-config-next 16.1.1; padronização do lockfile canônico (package-lock.json, npm); CI/automação via workflows (security.yml + upgrade-next-16-1-1.yml); registro de contexto Turbopack (build) e regras mínimas de smoke tests pós-upgrade\n"
}
],
"rules": {
"fail_if_anchor_missing": true,
"fail_if_target_missing": true,
"fail_if_section_already_exists_on_insert": true,
"fail_if_ambiguous_match": true,
"no_renumber": true,
"no_reformat": true,
"no_out_of_scope_changes": true
}
}
