{
  "meta": {
    "datetime": "22/01/2026 11:00",
    "origin": "revisao normativa",
    "scope": "documentacao",
    "execution_mode": "github_actions",
    "target_doc": "docs/base-tecnica.md",
    "warnings": []
  },
  "ops": [
    {
      "op": "replace_section",
      "doc_path": "docs/base-tecnica.md",
      "target": "0.1",
      "mode": "shallow",
      "content": "0.1. Cabeçalho\n• Documento: Base Técnica LP Factory 10\n• Versão: v1.9.10\n• Data: 22/01/2026\n• Escopo: regras e contratos técnicos do repositório (Next.js + Supabase + Vercel)\n"
    },
    {
      "op": "replace_section",
      "doc_path": "docs/base-tecnica.md",
      "target": "5.1.2",
      "mode": "shallow",
      "content": "5.1.2 Persistência SSR (cookie last_account_subdomain)\n• Definido em /a/[account]/layout.tsx somente quando allow=true, membro ativo e conta em status active|trial|pending_setup.\n• Atributos obrigatórios: HttpOnly; Secure; SameSite=Lax; Max-Age=7776000; Path=/.\n• Leitura do cookie ocorre no SSR do gateway /a/home para redirecionar /a/home → /a/{account_slug}.\n• Limpeza do cookie ocorre via /a/home?clear_last=1 (middleware zera Max-Age=0).\n• last_account_subdomain só é definido em /a/{account_slug} após allow; /a/home não define cookie.\n"
    },
    {
      "op": "replace_section",
      "doc_path": "docs/base-tecnica.md",
      "target": "5.4",
      "mode": "shallow",
      "content": "5.4 Regras da rota /a (anti-regressão)\n• /a é o entrypoint público e redireciona para /a/home.\n• /a/home é pública e funciona como gateway:\n• Sem sessão: renderiza home pública.\n• Com sessão: resolve conta via cookie last_account_subdomain e redireciona para /a/{account_slug}.\n• Com sessão e sem conta resolvida: redireciona para /auth/confirm/info.\n• Dashboard privado só em /a/{account_slug}.\n• allow/deny é responsabilidade do gate SSR em /a/{account_slug}.\n• /a/home bypassa o gate SSR de conta em app/a/[account]/layout.tsx.\n• Se o gate negar com usuário autenticado: redirecionar para /a/home?clear_last=1 para limpar o cookie e forçar fallback determinístico (sem loop).\n• “Solicitar acesso” em /auth/confirm/info abre mailto (não é rota interna do app).\n• Se ctx.blocked por membership.status: redirecionar para:\n• pending → /auth/confirm/pending\n• inactive → /auth/confirm/inactive\n• revoked → /auth/confirm/revoked\n• Se ctx.blocked por conta (ctx.error_code=\"FORBIDDEN_ACCOUNT\"): redirecionar para:\n• accounts.status=inactive → /auth/confirm/account/inactive\n• accounts.status=suspended → /auth/confirm/account/suspended\n• fallback → /auth/confirm/account\n"
    },
    {
      "op": "insert_after_heading",
      "doc_path": "docs/base-tecnica.md",
      "heading": "99. Changelog",
      "content": "v1.9.10 (22/01/2026) — Gate SSR: bloqueio por status (membership/conta)\n• Ajustado 5.4 para incluir roteamento de bloqueio por status de membership e por conta via FORBIDDEN_ACCOUNT (inactive/suspended) para rotas /auth/confirm dedicadas, mantendo fallback genérico.\n• Corrigida linha truncada em 5.1.2 (atributos do cookie last_account_subdomain: Path=/.)\n"
    }
  ],
  "rules": {
    "fail_if_anchor_missing": true,
    "fail_if_target_missing": true,
    "fail_if_section_already_exists_on_insert": true,
    "fail_if_ambiguous_match": true,
    "no_renumber": true,
    "no_reformat": true,
    "no_out_of_scope_changes": true
  }
}
