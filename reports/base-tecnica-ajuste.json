{
"meta": {
"datetime": "14/01/2026 20:00",
"origin": "ajuste pontual",
"scope": "documentacao",
"execution_mode": "github_actions",
"target_doc": "docs/base-tecnica.md",
"warnings": []
},
"ops": [
{
"op": "replace_section",
"doc_path": "docs/base-tecnica.md",
"target": "0.1",
"mode": "shallow",
"content": "0.1. Cabeçalho\n• Documento: Base Técnica LP Factory 10\n• Versão: v1.9.8\n• Data: 14/01/2026\n• Escopo: regras e contratos técnicos do repositório (Next.js + Supabase + Vercel)\n"
},
{
"op": "replace_section",
"doc_path": "docs/base-tecnica.md",
"target": "2.4",
"mode": "shallow",
"content": "2.4. Supabase Auth URL allowlist (Redirect URLs)\n• Local: Supabase Dashboard → Authentication → URL Configuration → Redirect URLs\n• Regra: permitir somente domínios/paths necessários (produção + localhost).\n• Regra (Preview Vercel): quando for necessário habilitar preview, usar wildcard com “/**” para cobrir paths profundos (ex.: https://*-<slug>.vercel.app/**).\n• Regra: não usar curingas amplos fora de preview (evitar allowlist que aceite domínios externos).\n"
},
{
"op": "replace_section",
"doc_path": "docs/base-tecnica.md",
"target": "3.4",
"mode": "shallow",
"content": "3.4 CI/Lint (Bloqueios)\n• Validação por PR + preview de deploy (Vercel)\n• PATH: .github/workflows/security.yml\n• Bloqueio de segurança: impedir padrões de implicit flow em client/UI (access_token, refresh_token, setSession, getSessionFromUrl)\n• Regra: o bloqueio de tokens/sessão ignora app/auth/confirm/** (allowlist mínima para handler server-side)\n• Regra: verifyOtp() só pode existir em app/auth/confirm/**\n• Regra de merge (mínimo): validação automática ok + preview ok + smoke de acesso (login/logout/reset de senha/navegação pós-login)\n• Regra: antes de merge, seguir obrigatoriamente o checklist da seção 7 (anti-regressão)\n"
},
{
"op": "replace_section",
"doc_path": "docs/base-tecnica.md",
"target": "5.3.2",
"mode": "shallow",
"content": "5.3.2. Password Reset (MVP)\n• Success: request from modal → email → link opens new tab → set new password (2x) → success → auto-redirect to dashboard; original modal shows “Processo concluído”.\n• Regra: link do e-mail deve apontar direto para /auth/update-password com token_hash e type=recovery (sem verificação em GET fora do app).\n• Regra anti-scanner: não consumir token no GET; confirmação do token ocorre somente no POST ao “Salvar nova senha”.\n• Expired link (10m): reset page shows “link expirou” + inline field to resend link.\n• Email not registered: modal shows neutral “Se este email estiver cadastrado…”.\n• Repeated requests: throttle; modal shows “aguarde” with countdown (5 min).\n• Save password errors: mismatch/weak/network-specific messages; allow another attempt; keep validity for 5 minutes after first error.\n• Link already used: reset page says so + inline resend.\n• User can go back to login anytime.\n• Rules: modal doesn’t auto-close except after final success; always alternatives; never force restart; clear, specific messages.\n"
},
{
"op": "insert_after_heading",
"doc_path": "docs/base-tecnica.md",
"heading": "99. Changelog",
"content": "v1.9.8 (14/01/2026) — Password Reset sem etapa “Continuar” (anti-scanner)\n• Atualizada a regra de Redirect URLs para preview Vercel (wildcard com “/**” para paths profundos).\n• Refinado o bloqueio de implicit flow no CI para permitir o handler server-side em app/auth/confirm/** sem afrouxar o restante do app/src.\n• Consolidado o fluxo de Password Reset para abrir direto em /auth/update-password e consumir token apenas no POST ao salvar a nova senha.\n"
}
],
"rules": {
"fail_if_anchor_missing": true,
"fail_if_target_missing": true,
"fail_if_section_already_exists_on_insert": true,
"fail_if_ambiguous_match": true,
"no_renumber": true,
"no_reformat": true,
"no_out_of_scope_changes": true
}
}
